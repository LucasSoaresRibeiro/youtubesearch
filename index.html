<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBMaranata - Pesquisa de Transcrição do YouTube</title>
    <script>

        async function fetchData() {
            const response = await fetch('transcricoes.json');
            return await response.json();
        }

        function cleanText(text) {
            return text.replace(/ {2,}/g, " ");
        }
        
        async function searchTranscription() {
            const data = await fetchData();
            const searchText = cleanText(document.getElementById('searchText').value.toLowerCase());
            let results = [];

            data.forEach(video => {
                video.transcricao.forEach(transcript => {
                    text = cleanText(transcript.text);
                    if (text.toLowerCase().includes(searchText)) {
                        const videoId = video.url.split('v=')[1];
                        const videoTime = Math.floor(transcript.tStartMs / 1000);
                        const videoUrlWithTime = `${video.url}&t=${videoTime}s`;
                        results.push(`
                            <div>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}?start=${videoTime}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                <p><a href="${videoUrlWithTime}" target="_blank">${transcript.text}</a></p>
                            </div>
                        `);
                    }
                });
            });

            document.getElementById('results').innerHTML = results.length > 0 ? results.join('') : 'Nenhum resultado encontrado';
        }
    </script>
</head>
<body>
    <h1>IBMaranata - Pesquisa de Transcrição do YouTube</h1>
    <input type="text" id="searchText" style="width: 50%; height: 20px;" placeholder="Digite o texto para pesquisar">
    <button onclick="searchTranscription()">Pesquisar</button>
    <p>Dica: Digite textos curtos para encontrar mais resultados</p>
    <div id="results"></div>
</body>
</html>
